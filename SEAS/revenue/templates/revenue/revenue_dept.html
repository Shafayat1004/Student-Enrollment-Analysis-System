{% extends 'base.html' %}
{% block title %}Revenue of {{schoolSelected}}{% endblock title %}

{% block content %}

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>


	<h1> Department-wise Revenue Breakdown of {{schoolSelected}}</h1>
	<div class= "searchRow">
		<form method="POST" class="semesterSelection">
			{% csrf_token %}
			{% comment %} {{ forms }} {% endcomment %}
			<select name="selectedSession">
				{% for session in sessions %}
					<option value="{{ session.0 }}">{{session.0}}</option>
				{% endfor %}
			</select>
			<select name="selectedYear">
				{% for year in years %}
					<option value="{{ year.0 }}">{{ year.0}}</option>
				{% endfor %}
			</select>
			<button type="submit">Load</button>
		</form> 
	</div>

	<div>
		<h1>Department-wise Revenue of {{schoolSelected}}</h1>
		<canvas id="schoolRevTrendChart"></canvas> 
		<h1>Revenue Distribution among {{schoolSelected}} Departments</h1>
		<canvas id="schoolRevDistChart"></canvas>

		<script>
			let ctx1 = document.getElementById("schoolRevTrendChart").getContext("2d");
            let ctx2 = document.getElementById("schoolRevDistChart").getContext("2d");

			let chartX = [ {% for semester in xAxis %} '{{semester}}', {% endfor %} ];

			let chart1_Y = [ 
                {% for key in yAxis %} 
                {
                    label: '{{key.label}}',
                    data: [ {% for rev in key.data %} {{rev}}, {% endfor %} ],
                    borderColor: '{{key.borderColor}}',
                    fill: false
                },
                {% endfor %}
            ]

			const chartTrend = new Chart( ctx1, {
					type: "line",
					data: {
						labels:   chartX,
						datasets: chart1_Y
					},
					options: {
						responsive: true,
						title: {
							text: "Revenue Trend of Departments",
							display: true,
							padding: {
								top: 10,
								bottom: 30
							}
						}
					}
				}          
			);

			let chart2_Y = [ 
				{% for key in yAxis %} 
				{
					label: '{{key.label}}',
					data: [ {% for rev in key.data %} {{rev}}, {% endfor %} ],
					borderColor: '{{key.borderColor}}',
					backgroundColor: '{{key.borderColor}}',
					fill: true
				},
				{% endfor %}
			]

			const chartDist = new Chart( ctx2, {
					type: "line",
					data: {
						labels:   chartX,
						datasets: chart2_Y
					},
					options: {
						responsive: true,
						title: {
							text: 'Revenue Distribution among Departments',
							display: true,
							padding: {
								top: 10,
								bottom: 30
							}
						},
						scales: {
							y: { stacked: 'single' }
						}
					}
				}          
			);

		</script>		
	</div>

	<div class="panel-group">
		<div class="panel panel-default">
		  <div class="panel-heading">
			<h1 class="panel-title">
			  <a data-toggle="collapse" href="#collapse1">Revenue Data Table</a>
			</h1>
		  </div>
		  <div id="collapse1" class="panel-collapse collapse">
				<table class='table'>
					<thead>
						<tr><th colspan="10" style="text-align:center">Historical Revenue Data of {{schoolSelected}}</th></tr>
					</thead>
					<thead>
						<tr>
							{% for colName in colNames %}​
							<th>​{{colName}}​</th>
							​{% endfor %} 
						​</tr> 
					</thead>
					<tbody>
						{% for row in revenues %} 
						<tr>
							{% for item in row %}
							<td>​{{item}}​</td> 
							{% endfor %}
						</tr>
						{% endfor %}
					</tbody> 
				</table>
		  </div>
		</div>
	</div> 

	
</div>
{% endblock content %}